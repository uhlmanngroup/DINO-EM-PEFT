# Environment: cluster (UZH Science) - Lucchi++ segmentation run

# ---- I/O ----
# Droso:
# train_img_dir: "/home/cfuste/data/datasets/Droso/Train_In"
# train_mask_dir: "/home/cfuste/data/datasets/Droso/Train_Out"
# test_img_dir:    "/home/cfuste/data/datasets/Droso/Test_In"
# test_mask_dir:   "/home/cfuste/data/datasets/Droso/Test_Out"

# Lucchi++:
train_img_dir: "/home/cfuste/data/datasets/Lucchi++/Train_In"
train_mask_dir: "/home/cfuste/data/datasets/Lucchi++/Train_Out"
test_img_dir:    "/home/cfuste/data/datasets/Lucchi++/Test_In"
test_mask_dir:   "/home/cfuste/data/datasets/Lucchi++/Test_Out"

# results + experiment naming (stored under /data to persist on the cluster)
experiment_id: "2026-02-11_lucchi_dinov2_fullft_seg"
results_root: "/home/cfuste/data/DINO-LoRA/dinov2/seg/"
task_type: "lucchi-fullft"

# dataset pairing (Lucchi images are named maskXXXX vs masks as digits)
dataset:
  type: lucchi
  params:
    recursive: false
    image_prefix: "mask"
    zfill_width: 4

# ---- model / backbone ----
backbone:
  name: dinov2
  variant: base
  load_backend: torchhub
  weights: null
  repo_dir: null
  preprocess:
    preset: em

dino_size: base
img_size:
  mode: longest_edge
  target: 1022   # largest <= 1024 while staying multiple of 14
  patch_multiple: 14
  rounding: floor
num_classes: 2

# ---- fine-tuning ----
use_lora: false
full_finetune: true

# ---- training ----
batch_size: 2
epochs: 1000
patience: 20
lr: 0.00005
weight_decay: 0.0001
num_workers: 4
device: auto
amp: false
val_ratio: 0.1
split_seed: 42

# ---- loss (CE + Tversky on foreground) ----
loss: dice      # ce, dice, ce_tversky
class_weights: [1.0, 15.0]    # bg, fg
tversky_alpha: 0.7
tversky_beta: 0.3
tversky_eps: 1.0e-6
tversky_weight: 0.6   # lambda: 0.6*Tversky + 0.4*CE

# ---- training safety ----
clip_grad_norm: 1.0   # global grad clip

# ---- export / viz ----
binarize: true
binarize_threshold: 128